<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<body>

<aside class="w-full md:w-1/4 lg:w-1/3 md:pl-8 space-y-6" th:fragment="course-sidebar">

    <div class="bg-white p-5 rounded-lg shadow-sm">
        <h3 class="font-bold text-lg mb-3">Tìm kiếm Khóa học</h3>
        <form th:action="@{/courses}" method="GET" class="space-y-2">

            <div class="relative">
                <input type="text"
                       name="keyword"
                       id="search-keyword-input" th:value="${keyword}"
                       placeholder="Nhập tên khóa học..."
                       class="w-full px-4 py-2 pr-10 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300"/> <button type="button"
                                                                                                                                      id="search-clear-btn" class="absolute inset-y-0 right-0 flex items-center justify-center w-10 text-gray-500 hover:text-gray-700 hidden" aria-label="Xóa tìm kiếm">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            </div>

            <input type="hidden" name="categoryId" th:value="${selectedCategoryId}" th:if="${selectedCategoryId != null}" />
            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700">Tìm</button>
        </form>
    </div>

    <div class="bg-white p-5 rounded-lg shadow-sm">
        <h3 class="font-bold text-lg mb-3">Danh mục</h3>
        <ul class="space-y-2">
            <li>
                <a th:href="@{/courses(keyword=${keyword})}"
                   class="text-gray-700 hover:text-blue-600"
                   th:classappend="${selectedCategoryId == null} ? 'font-bold text-blue-600'">
                    Tất cả khóa học
                </a>
            </li>
            <li th:each="cat : ${courseCategories}">
                <a th:href="@{/courses(categoryId=${cat.id}, keyword=${keyword})}"
                   th:text="${cat.name}"
                   th:classappend="${cat.id == selectedCategoryId} ? 'font-bold text-blue-600'"></a>
            </li>
        </ul>
    </div>

    <th:block th:inline="javascript">
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const searchInput = document.getElementById('search-keyword-input');
                const clearButton = document.getElementById('search-clear-btn');

                // Chỉ thực thi nếu 2 phần tử tồn tại
                if (searchInput && clearButton) {

                    // Hàm kiểm tra và cập nhật trạng thái hiển thị của nút "x"
                    function updateClearButtonVisibility() {
                        if (searchInput.value.length > 0) {
                            clearButton.classList.remove('hidden');
                        } else {
                            clearButton.classList.add('hidden');
                        }
                    }

                    // 1. Kiểm tra ngay khi trang tải xong
                    // (quan trọng khi load lại trang với giá trị keyword có sẵn)
                    updateClearButtonVisibility();

                    // 2. Lắng nghe sự kiện 'input' (mỗi khi người dùng gõ)
                    searchInput.addEventListener('input', updateClearButtonVisibility);

                    // 3. Lắng nghe sự kiện 'click' trên nút "x"
                    clearButton.addEventListener('click', function() {
                        searchInput.value = ''; // Xóa nội dung
                        clearButton.classList.add('hidden'); // Ẩn nút "x"
                        searchInput.focus(); // Đưa con trỏ chuột về lại ô input
                    });
                }
            });
        </script>
    </th:block>

</aside>

</body>
</html>