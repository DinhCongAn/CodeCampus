<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <!-- ================= META & TITLE ================= -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Gi·ªØ nguy√™n tham s·ªë ti√™u ƒë·ªÅ trang -->
    <title th:text="${pageTitle}">CodeCampus - Pro Coder Platform</title>

    <!-- ================= FONTS & ICONS ================= -->
    <!-- S·ª≠ d·ª•ng Manrope cho hi·ªán ƒë·∫°i v√† JetBrains Mono cho ch·∫•t "Code" -->
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome cho icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- ================= TAILWIND CSS ================= -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/images/logo.png" />

    <!-- ================= CONFIG & CUSTOM CSS ================= -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        // ƒê·ªãnh nghƒ©a b·∫£ng m√†u th∆∞∆°ng hi·ªáu chu·∫©n
                        brand: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            500: '#6366f1', // Indigo
                            600: '#4f46e5',
                            700: '#4338ca',
                            900: '#312e81',
                        }
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                        'glow': '0 0 20px rgba(79, 70, 229, 0.3)',
                    }
                }
            }
        }
    </script>

    <style>
        /* --- GLOBAL STYLES --- */
        body {
            background-color: #f8fafc;
            /* N·ªÅn gradient nh·∫π nh√†ng, hi·ªán ƒë·∫°i h∆°n */
            background-image:
                    radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.1) 0px, transparent 50%),
                    radial-gradient(at 100% 100%, rgba(168, 85, 247, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
            color: #1e293b;
            scroll-behavior: smooth;
        }

        /* --- GLASSMORPHISM CARD (ƒê·ªìng b·ªô) --- */
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Hi·ªáu ·ª©ng n·∫£y nh·∫π khi hover */
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-8px);
            box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.1);
            border-color: rgba(99, 102, 241, 0.4);
        }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* --- UTILITIES --- */
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .text-gradient { background: linear-gradient(135deg, #4f46e5 0%, #9333ea 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* --- CHAT STYLES --- */
        .chat-content a { color: #4f46e5; text-decoration: underline; font-weight: 600; }
        .message-enter { animation: slideIn 0.3s ease-out forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ANIMATIONS --- */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .animate-float-slow { animation: float 6s ease-in-out infinite; }
    </style>
</head>

<body class="antialiased font-sans selection:bg-brand-100 selection:text-brand-900">

<!-- ================= HEADER (Fragment) ================= -->
<div class="sticky top-0 z-50 glass-panel border-b border-slate-200/60 shadow-sm">
    <div class="text-slate-900">
        <div th:replace="~{fragments/header :: header}"></div>
    </div>
</div>

<div class="flex max-w-[1450px] mx-auto pt-6 px-4 sm:px-6 gap-8 relative pb-20">

    <!-- ================= DECOR BACKGROUND ================= -->
    <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-blue-400/20 rounded-full blur-[100px] opacity-50 mix-blend-multiply"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-purple-400/20 rounded-full blur-[100px] opacity-50 mix-blend-multiply"></div>
    </div>

    <!-- ================= SIDEBAR NAVIGATION (Floating Dock Style) ================= -->
    <aside class="hidden md:flex flex-col items-center sticky top-24 h-fit z-30">
        <div class="flex flex-col space-y-3 bg-white/90 backdrop-blur-md rounded-2xl p-2 shadow-glass border border-white/40 ring-1 ring-slate-900/5">
            <!-- Tooltips ƒë∆∞·ª£c th√™m v√†o title ƒë·ªÉ UX t·ªët h∆°n -->

            <!-- Home Link -->
            <a href="/home" class="group relative w-12 h-12 flex items-center justify-center rounded-xl transition-all duration-300 hover:bg-gradient-to-br hover:from-brand-500 hover:to-brand-600 hover:text-white text-slate-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                <span class="absolute left-full ml-3 px-2 py-1 bg-slate-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Trang ch·ªß</span>
            </a>

            <!-- Courses Link -->
            <a href="/courses" class="group relative w-12 h-12 flex items-center justify-center rounded-xl transition-all duration-300 hover:bg-gradient-to-br hover:from-emerald-500 hover:to-emerald-600 hover:text-white text-slate-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                <span class="absolute left-full ml-3 px-2 py-1 bg-slate-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Kh√≥a h·ªçc</span>
            </a>

            <!-- Blog Link -->
            <a href="/blog" class="group relative w-12 h-12 flex items-center justify-center rounded-xl transition-all duration-300 hover:bg-gradient-to-br hover:from-orange-500 hover:to-orange-600 hover:text-white text-slate-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path></svg>
                <span class="absolute left-full ml-3 px-2 py-1 bg-slate-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">B√†i vi·∫øt</span>
            </a>
        </div>
    </aside>

    <!-- ================= MAIN CONTENT ================= -->
    <main class="flex-1 w-full min-w-0 space-y-16">

        <!-- ================= HERO SLIDER SECTION ================= -->
        <section class="relative rounded-3xl overflow-hidden shadow-2xl group border border-slate-200/50">
            <div class="flex transition-transform duration-700 ease-[cubic-bezier(0.25,1,0.5,1)]" id="slider-wrapper">
                <!-- V√≤ng l·∫∑p Slider Thymeleaf gi·ªØ nguy√™n -->
                <div th:each="slider : ${sliders}" class="min-w-full relative shrink-0">
                    <div class="w-full relative bg-slate-100" style="aspect-ratio: 21/8;"> <!-- T·ªâ l·ªá ·∫£nh r·ªông h∆°n -->
                        <!-- ·∫¢nh n·ªÅn -->
                        <div class="absolute inset-0 bg-cover bg-center transition-transform duration-[10s] hover:scale-105"
                             th:style="'background-image: url(' + ${slider.imageUrl} + ');'"></div>

                        <!-- L·ªõp ph·ªß Gradient t·ªëi ∆∞u ƒë·ªçc text -->
                        <div class="absolute inset-0 bg-gradient-to-r from-slate-900/90 via-slate-900/50 to-transparent"></div>

                        <!-- N·ªôi dung Slider -->
                        <div class="absolute inset-0 flex flex-col justify-center px-10 md:px-20 max-w-5xl z-10">
                            <!-- Badge -->
                            <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 backdrop-blur-md text-white border border-white/20 text-[11px] font-bold tracking-wider mb-6 w-fit uppercase">
                                <span class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse shadow-[0_0_10px_rgba(52,211,153,0.5)]"></span> Featured Update
                            </span>

                            <!-- Ti√™u ƒë·ªÅ -->
                            <h2 class="text-3xl md:text-5xl lg:text-6xl font-black text-white leading-tight mb-4 drop-shadow-lg tracking-tight"
                                th:text="${slider.title}">Slider Title</h2>

                            <!-- M√¥ t·∫£ -->
                            <p class="text-base md:text-lg text-slate-200 font-medium mb-8 line-clamp-2 max-w-2xl leading-relaxed opacity-90"
                               th:text="${slider.notes}">Description</p>

                            <!-- N√∫t h√†nh ƒë·ªông -->
                            <div>
                                <a th:href="${slider.backlink}" class="group/btn relative inline-flex items-center px-8 py-3.5 bg-white text-brand-900 font-bold rounded-xl transition-all duration-300 hover:bg-brand-50 hover:shadow-[0_0_20px_rgba(255,255,255,0.4)] hover:-translate-y-1">
                                    <span>Kh√°m ph√° ngay</span>
                                    <svg class="w-4 h-4 ml-2 transition-transform duration-300 group-hover/btn:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Dots Navigation -->
            <div class="absolute bottom-6 left-1/2 -translate-x-1/2 flex space-x-2 z-20" id="slider-dots"></div>
        </section>

        <!-- ================= COURSES SECTION ================= -->
        <section>
            <!-- Section Header -->
            <div class="flex items-end justify-between mb-8 pb-4 border-b border-slate-200/60">
                <div>
                    <span class="text-brand-600 font-bold tracking-wider uppercase text-xs">L·ªô tr√¨nh b√†i b·∫£n</span>
                    <h3 class="text-3xl font-extrabold text-slate-800 mt-1">
                        Kh√≥a h·ªçc <span class="text-gradient">PRO</span>
                    </h3>
                </div>
                <a href="/courses" class="hidden sm:flex text-sm font-bold text-slate-500 hover:text-brand-600 transition-colors items-center group bg-white px-5 py-2.5 rounded-full shadow-sm border border-slate-200 hover:shadow-md hover:border-brand-200">
                    Xem t·∫•t c·∫£
                    <svg class="w-4 h-4 ml-1 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </a>
            </div>

            <!-- Grid Courses: Gi·ªØ nguy√™n bi·∫øn ${featuredCourses} -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <div th:each="course : ${featuredCourses}" class="glass-card group rounded-2xl flex flex-col h-full overflow-hidden">
                    <!-- Thumbnail Container -->
                    <a th:href="@{'/courses/' + ${course.id}}" class="block relative aspect-video overflow-hidden">
                        <img th:src="${course.thumbnailUrl}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700 ease-in-out"/>
                        <div class="absolute inset-0 bg-black/10 group-hover:bg-black/0 transition-colors"></div>
                        <!-- Badge -->
                        <div class="absolute top-3 left-3">
                            <span class="bg-white/95 backdrop-blur text-brand-700 text-[10px] font-black px-2.5 py-1 rounded-md uppercase shadow-sm border border-brand-100 flex items-center gap-1">
                                <i class="fa-solid fa-bolt text-yellow-500"></i> PRO
                            </span>
                        </div>
                    </a>

                    <!-- Content Info -->
                    <div class="p-5 flex flex-col flex-1">
                        <!-- T√™n kh√≥a h·ªçc -->
                        <h4 class="font-bold text-lg text-slate-800 group-hover:text-brand-600 transition-colors mb-1 line-clamp-2 leading-snug h-[3.2rem]"
                            th:text="${course.name}">T√™n kh√≥a h·ªçc</h4>

                        <!-- M√¥ t·∫£ / description -->
                        <p class="text-sm text-slate-600 mb-4 line-clamp-3 h-[4.5rem]"
                           th:text="${course.description != null ? course.description : #strings.abbreviate(course.description, 100)}">
                            M√¥ t·∫£ kh√≥a h·ªçc...
                        </p>

                        <!-- Meta Info -->
                        <div class="flex items-center space-x-4 text-xs text-slate-500 font-medium mt-1 mb-4">
                             <span class="flex items-center gap-1.5 bg-slate-100 px-2 py-1 rounded">
                                <i class="fa-solid fa-users text-slate-400"></i>
                                <span th:text="${course.studentCount} + ' H·ªçc Vi√™n'"></span>
                            </span>
                            <span class="flex items-center gap-1.5">
                                <i class="fa-solid fa-star text-yellow-400"></i>
                                <span th:text="${course.averageRating != null ? course.averageRating : 5.0}">4.9</span>
                            </span>
                        </div>

                        <!-- Footer Card -->
                        <div class="mt-auto pt-4 border-t border-dashed border-slate-200 flex items-center justify-between">
                            <div class="flex -space-x-2">
                                <!-- Fake Avatars -->
                                <img src="https://i.pravatar.cc/24?img=1" alt="User 1" class="w-6 h-6 rounded-full border-2 border-white object-cover">
                                <img src="https://i.pravatar.cc/24?img=2" alt="User 2" class="w-6 h-6 rounded-full border-2 border-white object-cover">
                                <img src="https://i.pravatar.cc/24?img=3" alt="User 3" class="w-6 h-6 rounded-full border-2 border-white object-cover">
                                <!-- N·∫øu mu·ªën th√™m s·ªë l∆∞·ª£ng ng∆∞·ªùi d√πng n·ªØa -->
                                <div class="w-6 h-6 rounded-full border-2 border-white bg-slate-400 flex items-center justify-center text-[8px] text-white font-bold">
                                    +9
                                </div>
                            </div>

                            <a th:href="@{'/courses/' + ${course.id}}" class="text-brand-600 text-[11px] font-extrabold uppercase tracking-wide bg-brand-50 px-3 py-1.5 rounded-lg hover:bg-brand-600 hover:text-white transition-all duration-300">
                                ƒêƒÉng k√Ω
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================= BLOG SECTION ================= -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <!-- ===== MAIN COLUMN (8/12) ===== -->
            <div class="lg:col-span-8 space-y-6">
                <div class="flex items-center gap-3 mb-2">
                    <span class="w-8 h-1 bg-gradient-to-r from-orange-500 to-red-500 rounded-full"></span>
                    <h3 class="text-2xl font-extrabold text-slate-800">B√†i vi·∫øt n·ªïi b·∫≠t</h3>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Duy·ªát danh s√°ch b√†i vi·∫øt hotPosts -->
                    <div th:each="post : ${hotPosts}" class="glass-card group rounded-2xl flex flex-col h-full overflow-hidden">
                        <!-- Thumbnail -->
                        <a th:href="@{'/blog/' + ${post.id}}" class="relative overflow-hidden aspect-[16/10]">
                            <img th:src="${post.thumbnailUrl}" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-500"/>
                            <!-- Date overlay -->
                            <div class="absolute bottom-3 left-3 bg-black/60 backdrop-blur-sm text-white text-[10px] px-2 py-1 rounded border border-white/20">
                                <i class="fa-regular fa-calendar mr-1"></i>
                                <span th:text="${#temporals.format(post.publishedAt ?: post.updatedAt, 'dd/MM/yyyy')}">Date</span>
                            </div>
                        </a>

                        <!-- Content -->
                        <div class="p-6 flex-1 flex flex-col">
                            <h4 class="text-lg font-bold text-slate-800 group-hover:text-orange-600 transition-colors mb-2 line-clamp-2 leading-tight">
                                <a th:href="@{'/blog/' + ${post.id}}" th:text="${post.title}">Ti√™u ƒë·ªÅ</a>
                            </h4>

                            <!-- Th√™m excerpt / t√≥m t·∫Øt -->
                            <p class="text-sm text-slate-600 mb-4 line-clamp-3" th:text="${post.content != null ? post.content : #strings.abbreviate(post.content, 100)}">
                                N·ªôi dung t√≥m t·∫Øt...
                            </p>

                            <div class="mt-auto flex items-center justify-between pt-4 border-t border-slate-100">
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-xs text-slate-500">
                                        <i class="fa-solid fa-user"></i>
                                    </div>
                                    <span class="text-xs text-slate-500 font-medium" th:text="${post.author != null ? post.author.fullName : 'Admin'}">Author</span>
                                </div>
                                <a th:href="@{'/blog/' + ${post.id}}" class="text-orange-500 text-xs font-bold hover:underline cursor-pointer">
                                    ƒê·ªçc ti·∫øp &rarr;
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- ===== SIDEBAR COLUMN (4/12) ===== -->
            <div class="lg:col-span-4">
                <div class="bg-white/60 backdrop-blur-md rounded-2xl p-6 sticky top-28 border border-white/50 shadow-sm">
                    <h3 class="text-lg font-bold text-slate-800 mb-6 flex items-center gap-2 pb-3 border-b border-slate-200">
                        <i class="fa-solid fa-newspaper text-brand-500"></i> M·ªõi xu·∫•t b·∫£n
                    </h3>

                    <!-- List m·ªõi nh·∫•t: Gi·ªØ nguy√™n ${latestPostsForSidebar} -->
                    <div class="space-y-5">
                        <div th:each="post : ${latestPostsForSidebar}" class="group flex items-start gap-4">
                            <!-- Thumb nh·ªè -->
                            <a th:href="@{'/blog/' + ${post.id}}" class="shrink-0 overflow-hidden rounded-lg w-20 h-20 shadow-sm group-hover:shadow-md transition-all">
                                <img th:src="${post.thumbnailUrl}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500"/>
                            </a>

                            <!-- Info -->
                            <div class="flex-1 min-w-0 py-1">
                                <a th:href="@{'/blog/' + ${post.id}}"
                                   class="block text-sm font-bold text-slate-700 line-clamp-2 mb-2 group-hover:text-brand-600 transition-colors"
                                   th:text="${post.title}">Title</a>
                                <p class="text-[10px] text-slate-400 uppercase font-semibold tracking-wider"
                                   th:text="${#temporals.format(post.publishedAt ?: post.updatedAt, 'dd MMM, yyyy')}">Date</p>
                            </div>
                        </div>
                    </div>

                    <a href="/blog" class="block mt-6 text-center text-xs font-bold text-slate-500 hover:text-brand-600 border border-dashed border-slate-300 rounded-lg py-2 hover:border-brand-300 transition-all">
                        Xem t·∫•t c·∫£ b√†i vi·∫øt
                    </a>
                </div>
            </div>
        </div>

        <!-- ================= STATS SECTION ================= -->
        <section id="system-stats" class="relative overflow-hidden rounded-3xl bg-white shadow-xl border border-slate-100 my-16">
            <!-- Background pattern nh·∫π -->
            <div class="absolute inset-0 opacity-[0.03]" style="background-image: radial-gradient(#4f46e5 1px, transparent 1px); background-size: 20px 20px;"></div>

            <div class="relative z-10 px-6 py-16 text-center">
                <!-- Grid Stats -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 max-w-6xl mx-auto divide-y sm:divide-y-0 sm:divide-x divide-slate-100">

                    <!-- Stat 1: Total Students -->
                    <div class="p-4 group">
                        <div class="text-4xl md:text-5xl font-black text-brand-600 mb-2 tracking-tight">
                            <span id="totalStudents" th:data-target="${totalStudents}" class="counter">0</span>+
                        </div>
                        <div class="text-sm font-bold text-slate-600 uppercase tracking-wide">H·ªçc vi√™n to√†n h·ªá th·ªëng</div>
                    </div>

                    <!-- Stat 2: Today Students -->
                    <div class="p-4 group">
                        <div class="text-4xl md:text-5xl font-black text-emerald-500 mb-2 tracking-tight">
                            <span id="todayStudents" th:data-target="${todayStudents}" class="counter">0</span>
                        </div>
                        <div class="text-sm font-bold text-slate-600 uppercase tracking-wide">Ho·∫°t ƒë·ªông h√¥m nay</div>
                    </div>

                    <!-- Stat 3: Enrollments -->
                    <div class="p-4 group">
                        <div class="text-4xl md:text-5xl font-black text-orange-500 mb-2 tracking-tight">
                            <span id="topCourseEnroll" th:data-target="${topCourseEnroll}" class="counter">0</span>+
                        </div>
                        <div class="text-sm font-bold text-slate-600 uppercase tracking-wide">ƒêƒÉng k√Ω kh√≥a PRO</div>
                    </div>

                    <!-- Stat 4: Completion Rate -->
                    <div class="p-4 group">
                        <div class="text-4xl md:text-5xl font-black text-purple-500 mb-2 tracking-tight">
                            <span id="completionRate" th:data-target="${completionRate}" class="counter">0</span>%
                        </div>
                        <div class="text-sm font-bold text-slate-600 uppercase tracking-wide">T·ª∑ l·ªá ho√†n th√†nh</div>
                    </div>
                </div>

                <!-- Trust Badge -->
                <div class="mt-12 flex justify-center">
                    <div class="inline-flex items-center gap-3 px-5 py-2 bg-slate-50 rounded-full border border-slate-200 text-sm text-slate-600">
                        <i class="fa-solid fa-shield-heart text-brand-500"></i>
                        <span>N·ªÅn t·∫£ng l·∫≠p tr√¨nh ƒë∆∞·ª£c tin d√πng b·ªüi <strong>[[${totalStudents}]]</strong> developer</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================= FEEDBACK SECTION ================= -->
        <section id="feedback" class="py-10 relative">
            <div class="text-center mb-12">
                <span class="text-brand-600 font-bold tracking-wider uppercase text-xs bg-brand-50 px-3 py-1 rounded-full border border-brand-100">
                    Review
                </span>
                <h2 class="text-3xl md:text-4xl font-black text-slate-800 mt-4">H·ªçc vi√™n n√≥i g√¨?</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Gi·ªØ nguy√™n bi·∫øn ${feedbacks} -->
                <div th:each="fb : ${feedbacks}" class="bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border border-slate-100 relative">
                    <!-- Icon quote -->
                    <div class="text-slate-100 absolute top-4 right-6 text-6xl font-serif leading-none select-none">‚Äù</div>

                    <!-- Stars -->
                    <div class="flex items-center mb-4 text-yellow-400 text-sm">
                        <th:block th:each="i : ${#numbers.sequence(1, 5)}">
                            <i th:class="${i <= fb.rating} ? 'fa-solid fa-star' : 'fa-regular fa-star text-slate-300'"></i>
                        </th:block>
                    </div>

                    <!-- Comment -->
                    <p class="text-slate-600 mb-6 relative z-10 italic leading-relaxed" th:text="${fb.comment}">Comment content</p>

                    <!-- User Info -->
                    <div class="flex items-center mt-auto pt-4 border-t border-slate-50 gap-3">
                        <img class="w-10 h-10 rounded-full object-cover ring-2 ring-white shadow-sm"
                             th:src="${fb.user.avatarUrl != null ? fb.user.avatarUrl : '/images/default-avatar.png'}"
                             alt="User Avatar">
                        <div>
                            <h4 class="text-sm font-bold text-slate-800" th:text="${fb.user.fullName}">Name</h4>
                            <p class="text-[10px] text-brand-600 font-bold uppercase truncate max-w-[140px]" th:text="${fb.course.name}">Course</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-10">
                <a href="/courses" class="text-sm font-bold text-slate-500 hover:text-slate-800 underline decoration-slate-300 underline-offset-4">Xem th√™m ƒë√°nh gi√°</a>
            </div>
        </section>

    </main>
</div>

<!-- ================= AI CHAT WIDGET (Modern Float) ================= -->
<div class="fixed bottom-6 right-6 z-50 flex flex-col items-end pointer-events-none">

    <!-- Chat Window -->
    <div id="ai-chat-window" class="pointer-events-auto bg-white w-[360px] h-[550px] rounded-2xl shadow-2xl border border-slate-100 mb-4 transform transition-all duration-300 translate-y-10 opacity-0 invisible flex flex-col overflow-hidden ring-1 ring-slate-900/5 font-sans origin-bottom-right">

        <!-- Chat Header -->
        <div class="bg-gradient-to-r from-brand-600 to-brand-700 px-5 py-4 flex items-center justify-between cursor-pointer shadow-md" id="header-chat">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-lg backdrop-blur-sm border border-white/20">
                    ü§ñ
                </div>
                <div>
                    <h4 class="font-bold text-sm text-white">Tr·ª£ l√Ω CodeCampus</h4>
                    <div class="flex items-center space-x-1.5">
                        <span class="w-1.5 h-1.5 bg-emerald-400 rounded-full animate-pulse shadow-sm"></span>
                        <span class="text-[10px] text-white/90 font-medium">S·∫µn s√†ng h·ªó tr·ª£</span>
                    </div>
                </div>
            </div>
            <!-- Chat Actions -->
            <div class="flex items-center space-x-1">
                <button id="clear-chat" class="text-white/70 hover:text-white hover:bg-white/10 p-1.5 rounded transition-colors" title="X√≥a l·ªãch s·ª≠">
                    <i class="fa-solid fa-trash-can text-xs"></i>
                </button>
                <button id="close-chat" class="text-white/70 hover:text-white hover:bg-white/10 p-1.5 rounded transition-colors">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
        </div>

        <!-- Messages Area -->
        <div id="chat-messages" class="flex-1 bg-slate-50 p-4 overflow-y-auto space-y-4 scroll-smooth">
            <!-- Tin nh·∫Øn m·∫∑c ƒë·ªãnh s·∫Ω ƒë∆∞·ª£c JS load -->
        </div>

        <!-- Input Area -->
        <div class="p-3 bg-white border-t border-slate-100 shrink-0">
            <form id="chat-form" class="relative flex items-center gap-2">
                <input type="text" id="chat-input" placeholder="H·ªèi g√¨ ƒë√≥ v·ªÅ l·∫≠p tr√¨nh..." required
                       class="w-full bg-slate-100 text-slate-800 text-sm rounded-xl py-3 pl-4 pr-3 focus:outline-none focus:ring-2 focus:ring-brand-500/50 focus:bg-white transition-all placeholder-slate-400">
                <button type="submit" class="p-3 bg-brand-600 hover:bg-brand-700 text-white rounded-xl transition-all shadow-md hover:shadow-lg flex-shrink-0">
                    <i class="fa-solid fa-paper-plane text-xs"></i>
                </button>
            </form>
            <p class="text-[10px] text-center text-slate-400 mt-2">AI c√≥ th·ªÉ ƒë∆∞a ra th√¥ng tin ch∆∞a ch√≠nh x√°c.</p>
        </div>
    </div>

    <!-- Floating Toggle Button -->
    <button id="toggle-chat" class="pointer-events-auto group relative flex items-center justify-center w-14 h-14 bg-brand-600 text-white rounded-full shadow-[0_8px_30px_rgb(79,70,229,0.4)] hover:shadow-brand-500/60 transition-all duration-300 animate-float-slow hover:scale-110 border-2 border-white">
        <i class="fa-solid fa-comment-dots text-2xl"></i>
        <!-- Notification Dot -->
        <span class="absolute top-0 right-0 flex h-3.5 w-3.5">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-3.5 w-3.5 bg-red-500 border-2 border-white"></span>
        </span>
    </button>
</div>

<!-- Fragment Footer gi·ªØ nguy√™n -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- ================= JAVASCRIPT LOGIC ================= -->
<script>
    document.addEventListener('DOMContentLoaded', function () {

        // --- 1. HERO SLIDER LOGIC ---
        // Gi·ªØ nguy√™n logic c≈© nh∆∞ng vi·∫øt g·ªçn l·∫°i
        const sliderWrapper = document.getElementById('slider-wrapper');
        const sliderDotsContainer = document.getElementById('slider-dots');

        if (sliderWrapper && sliderWrapper.children.length > 0) {
            const slides = sliderWrapper.children;
            const totalSlides = slides.length;
            let currentSlide = 0;
            let slideInterval;

            // T·∫°o dots
            for (let i = 0; i < totalSlides; i++) {
                const dot = document.createElement('div');
                dot.className = `h-1.5 rounded-full cursor-pointer transition-all duration-300 backdrop-blur-md shadow-lg border border-white/20 ${i === 0 ? 'w-8 bg-white' : 'w-2 bg-white/40 hover:bg-white/80'}`;
                dot.addEventListener('click', () => { goToSlide(i); resetInterval(); });
                sliderDotsContainer.appendChild(dot);
            }
            const dots = sliderDotsContainer.children;

            function updateDots() {
                for (let i = 0; i < dots.length; i++) {
                    dots[i].className = 'h-1.5 w-2 bg-white/40 hover:bg-white/80 rounded-full transition-all duration-300 shadow-sm border border-white/20';
                }
                dots[currentSlide].className = 'h-1.5 w-8 bg-white rounded-full transition-all duration-300 shadow-lg';
            }

            function goToSlide(slideIndex) {
                currentSlide = slideIndex;
                sliderWrapper.style.transform = `translateX(-${currentSlide * 100}%)`;
                updateDots();
            }

            function nextSlide() {
                let next = (currentSlide + 1) % totalSlides;
                goToSlide(next);
            }

            function resetInterval() {
                clearInterval(slideInterval);
                slideInterval = setInterval(nextSlide, 6000); // TƒÉng th·ªùi gian l√™n 6s cho d·ªÖ ƒë·ªçc
            }

            slideInterval = setInterval(nextSlide, 6000);
        }

        // --- 2. AI CHAT LOGIC (IMPROVED) ---
        const toggleBtn = document.getElementById('toggle-chat');
        const chatWindow = document.getElementById('ai-chat-window');
        const closeChatBtn = document.getElementById('close-chat');
        const clearChatBtn = document.getElementById('clear-chat');
        const headerChat = document.getElementById('header-chat');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const messagesContainer = document.getElementById('chat-messages');
        const STORAGE_KEY = 'codecampus_ai_chat_history';

        // Tin nh·∫Øn ch√†o m·ª´ng chu·∫©n
        const INTRO_MSG = `
            <div class="flex items-start gap-3 message-enter" id="intro-msg">
                <div class="w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-xs shrink-0 text-slate-700 shadow-sm">ü§ñ</div>
                <div class="flex flex-col space-y-1 max-w-[85%]">
                    <div class="bg-white text-slate-700 px-4 py-3 rounded-2xl rounded-tl-none text-[13px] shadow-sm border border-slate-100 leading-relaxed chat-content">
                        <b>Ch√†o b·∫°n! üëã</b><br>
                        M√¨nh l√† tr·ª£ l√Ω ·∫£o CodeCampus. B·∫°n c·∫ßn t√¨m kh√≥a h·ªçc n√†o h√¥m nay?
                    </div>
                </div>
            </div>`;

        function formatMessageContent(text) {
            let safeText = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            safeText = safeText.replace(urlRegex, url => `<a href="${url}" target="_blank">${url}</a>`);
            safeText = safeText.replace(/\n/g, '<br>');
            return safeText;
        }

        function loadChatHistory() {
            const history = localStorage.getItem(STORAGE_KEY);
            if (history) {
                try {
                    const messages = JSON.parse(history);
                    if(messages.length === 0) messagesContainer.innerHTML = INTRO_MSG;
                    else messages.forEach(msg => { appendMessage(msg.text, msg.isUser, false); });
                } catch (e) { messagesContainer.innerHTML = INTRO_MSG; }
            } else {
                messagesContainer.innerHTML = INTRO_MSG;
            }
        }

        function saveMessageToStorage(text, isUser) {
            let messages = [];
            const history = localStorage.getItem(STORAGE_KEY);
            if (history) { try { messages = JSON.parse(history); } catch (e) { messages = []; } }
            messages.push({ text: text, isUser: isUser, timestamp: new Date().getTime() });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(messages));
        }

        function toggleChat() {
            const isInvisible = chatWindow.classList.contains('invisible');
            if (isInvisible) {
                chatWindow.classList.remove('invisible', 'opacity-0', 'translate-y-10');
                toggleBtn.classList.add('opacity-0', 'scale-0');
                setTimeout(() => chatInput.focus(), 300);
            } else {
                chatWindow.classList.add('opacity-0', 'translate-y-10');
                toggleBtn.classList.remove('opacity-0', 'scale-0');
                setTimeout(() => chatWindow.classList.add('invisible'), 300);
            }
        }

        // Event Listeners cho Chat
        toggleBtn.addEventListener('click', toggleChat);
        closeChatBtn.addEventListener('click', toggleChat);
        headerChat.addEventListener('click', (e) => {
            if (e.target.closest('button')) return; // Kh√¥ng toggle n·∫øu click n√∫t ƒë√≥ng/x√≥a
            toggleChat();
        });

        if (clearChatBtn) {
            clearChatBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if(confirm("X√≥a to√†n b·ªô cu·ªôc tr√≤ chuy·ªán?")) {
                    localStorage.removeItem(STORAGE_KEY);
                    messagesContainer.innerHTML = INTRO_MSG;
                }
            });
        }

        function appendMessage(text, isUser, saveToStorage = true) {
            if (saveToStorage) saveMessageToStorage(text, isUser);

            const div = document.createElement('div');
            div.className = `flex items-start gap-3 message-enter ${isUser ? 'flex-row-reverse' : ''}`;

            const avatar = isUser ? '' : `<div class="w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-xs shrink-0 text-slate-700 shadow-sm mt-1">ü§ñ</div>`;

            // M√†u s·∫Øc bubble: User (Brand Color), Bot (White)
            const bubbleClass = isUser
                ? 'bg-brand-600 text-white rounded-2xl rounded-tr-none shadow-md shadow-brand-500/20'
                : 'bg-white text-slate-700 rounded-2xl rounded-tl-none shadow-sm border border-slate-200/60';

            const formattedContent = formatMessageContent(text);

            div.innerHTML = `
                ${avatar}
                <div class="flex flex-col space-y-1 max-w-[85%] ${isUser ? 'items-end' : 'items-start'}">
                    <div class="${bubbleClass} px-4 py-2.5 text-[13px] leading-relaxed chat-content break-words">
                        ${formattedContent}
                    </div>
                </div>
            `;
            messagesContainer.appendChild(div);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function appendLoading() {
            const div = document.createElement('div');
            div.id = 'ai-loading';
            div.className = 'flex items-start gap-3 message-enter';
            div.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-xs shrink-0 text-slate-700 shadow-sm mt-1">ü§ñ</div>
                <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm border border-slate-200 flex space-x-1 items-center h-10">
                    <span class="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"></span>
                    <span class="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></span>
                    <span class="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                </div>
            `;
            messagesContainer.appendChild(div);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Chat Submit Logic
        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const message = chatInput.value.trim();
            if (!message) return;

            appendMessage(message, true);
            chatInput.value = '';
            appendLoading();

            try {
                // Call API (Gi·∫£ l·∫≠p endpoint)
                const response = await fetch('/api/ai/consult', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });

                const loadingEl = document.getElementById('ai-loading');
                if (loadingEl) loadingEl.remove();

                if (!response.ok) throw new Error(`Status: ${response.status}`);
                const data = await response.json();

                if (data && data.reply) appendMessage(data.reply, false);
                else appendMessage("Xin l·ªói, m√¨nh ƒëang g·∫∑p ch√∫t tr·ª•c tr·∫∑c.", false);

            } catch (error) {
                const loadingEl = document.getElementById('ai-loading');
                if (loadingEl) loadingEl.remove();
                appendMessage("M·∫•t k·∫øt n·ªëi server. Vui l√≤ng th·ª≠ l·∫°i sau.", false, false);
            }
        });

        loadChatHistory();
    });

    // --- 3. COUNTER ANIMATION LOGIC (Intersection Observer) ---
    document.addEventListener("DOMContentLoaded", () => {
        const counters = document.querySelectorAll('.counter');
        const speed = 100; // T·ªëc ƒë·ªô nhanh h∆°n ch√∫t

        const animateCounters = () => {
            counters.forEach(counter => {
                const updateCount = () => {
                    const target = +counter.getAttribute('data-target');
                    const count = +counter.innerText;
                    const inc = Math.ceil(target / speed); // T√≠nh step nh·∫£y

                    if (count < target) {
                        counter.innerText = count + inc > target ? target : count + inc;
                        setTimeout(updateCount, 15);
                    } else {
                        counter.innerText = target;
                    }
                };
                updateCount();
            });
        };

        const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting) {
                animateCounters();
                observer.disconnect();
            }
        }, { threshold: 0.5 });

        const statsSection = document.getElementById('system-stats');
        if (statsSection) {
            observer.observe(statsSection);
        }
    });
</script>
</body>
</html>